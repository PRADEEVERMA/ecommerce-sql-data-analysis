-- 1. Total Revenue & Profit
SELECT 
SUM((p.selling_price - (p.selling_price * oi.discount_percent/100)) * oi.quantity) AS total_revenue,
SUM((p.selling_price - p.cost_price) * oi.quantity) AS total_profit
FROM order_items oi
JOIN products p ON oi.product_id = p.product_id;

-- 2. Top 5 Profitable Products
SELECT p.product_name,
SUM((p.selling_price - p.cost_price) * oi.quantity) AS profit
FROM order_items oi
JOIN products p ON oi.product_id = p.product_id
GROUP BY p.product_name
ORDER BY profit DESC
LIMIT 5;

-- 3. Repeat Customers
SELECT c.customer_name, COUNT(o.order_id) AS total_orders
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_name
HAVING COUNT(o.order_id) > 1;

-- 4. Monthly Sales Trend
SELECT 
TO_CHAR(o.order_date,'YYYY-MM') AS month,
SUM(p.selling_price * oi.quantity) AS sales
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
GROUP BY month
ORDER BY month;

-- 5. Discount Impact
SELECT 
CASE 
WHEN discount_percent = 0 THEN 'No Discount'
WHEN discount_percent <= 10 THEN 'Low Discount'
ELSE 'High Discount'
END AS discount_type,
COUNT(*) AS order_count
FROM order_items
GROUP BY discount_type;
